deptrac:
    paths:
        - ./src
    exclude_files:
        - '#/Tests/#'

    layers:
        # ---- Shared Kernel
        -   name: SharedDomain
            collectors:
                -   type: classNameRegex
                    value: '#^App\\SharedKernel\\Domain\\#'

        -   name: SharedApplication
            collectors:
                -   type: classNameRegex
                    value: '#^App\\SharedKernel\\Application\\#'

        -   name: SharedInfrastructure
            collectors:
                -   type: classNameRegex
                    value: '#^App\\SharedKernel\\Infrastructure\\#'

        # ---- Order BC
        -   name: OrderDomain
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Domain\\#'

        -   name: OrderApplication
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Application\\#'

        -   name: OrderInfrastructure
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Infrastructure\\#'

        -   name: OrderPresentation
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Presentation\\#'

        -   name: OrderIntegration
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Integration\\OrderCatalogue\\#'

        # ---- Catalogue BC
        -   name: CatalogueDomain
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Domain\\#'

        -   name: CatalogueApplication
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Application\\#'

        -   name: CatalogueInfrastructure
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Infrastructure\\#'

        -   name: CataloguePresentation
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Presentation\\#'

        -   name: CatalogueContracts
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Contracts\\#'

        # ---- Doctrine (3rd-party)
        -   name: DoctrineInfrastructure
            collectors:
                -   type: classNameRegex
                    value: '#^Doctrine\\ORM\\(EntityManagerInterface|EntityManager)#'

    ruleset:
        # Shared Kernel
        SharedDomain: [ ]                             # must be dependency-free
        SharedApplication: [ SharedDomain ]           # orchestrates shared use-cases
        SharedInfrastructure:
            - SharedDomain
            - DoctrineInfrastructure                  # persistence/runtime plumbing

        # Order BC
        OrderDomain: [ SharedDomain ]                 # pure domain, only depends on shared primitives
        OrderApplication:
            - OrderDomain
            - SharedDomain
            - SharedApplication                       # use-cases, ports, no cross-BC deps
        OrderInfrastructure:
            - OrderDomain
            - SharedDomain
            - DoctrineInfrastructure
            - SharedInfrastructure                    # impl of ports, persistence, etc.
        OrderPresentation:
            - OrderApplication
            - SharedApplication                       # controllers, CLI, UI; only call application

        # Catalogue BC
        CatalogueDomain: [ SharedDomain ]
        CatalogueApplication:
            - CatalogueDomain
            - SharedDomain
            - SharedApplication
            - CatalogueContracts                      # application can consume its own published language
        CatalogueInfrastructure:
            - CatalogueDomain
            - CatalogueApplication
            - SharedDomain
            - DoctrineInfrastructure
            - SharedInfrastructure
            - CatalogueContracts
        CataloguePresentation:
            - CatalogueApplication
            - SharedApplication

        # Cross-BC boundary
        OrderIntegration:
            - OrderApplication                        # implements Order ports
            - CatalogueApplication                    # calls Catalogue ports
            - CatalogueContracts                      # maps to published language
            - SharedApplication
        CatalogueContracts: [ SharedApplication, SharedDomain ] # must stay minimal, only shared types

    analyser:
        types:
            - class

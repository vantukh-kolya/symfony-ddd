deptrac:
    paths:
        - ./src
    exclude_files:
        - '#/Tests/#'

    layers:
        # ---- Shared Kernel
        -   name: SharedDomain
            collectors:
                -   type: classNameRegex
                    value: '#^App\\SharedKernel\\Domain\\#'

        -   name: SharedInfrastructure
            collectors:
                -   type: classNameRegex
                    value: '#^App\\SharedKernel\\Infrastructure\\#'

        # ---- Order BC
        -   name: OrderDomain
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Domain\\#'

        -   name: OrderApplication
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Application\\#'

        -   name: OrderInfrastructure
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Infrastructure\\#'

        -   name: OrderPresentation
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Presentation\\#'

        -   name: OrderIntegration
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Order\\Integration\\#'

        # ---- Catalogue BC
        -   name: CatalogueDomain
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Domain\\#'

        -   name: CatalogueApplication
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Application\\#'

        -   name: CatalogueInfrastructure
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Infrastructure\\#'

        -   name: CataloguePresentation
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Presentation\\#'

        -   name: CatalogueContracts
            collectors:
                -   type: classNameRegex
                    value: '#^App\\Catalogue\\Contracts\\#'

        # ---- Doctrine (3rd-party)
        -   name: DoctrineInfrastructure
            collectors:
                -   type: classNameRegex
                    value: '#^Doctrine\\ORM\\(EntityManagerInterface|EntityManager)#'

    ruleset:
        # Shared Kernel
        SharedDomain: [ ]                             # must be dependency-free
        SharedInfrastructure:
            - SharedDomain
            - DoctrineInfrastructure                  # persistence/runtime plumbing

        # Order BC
        OrderDomain: [ SharedDomain ]                 # pure domain, only depends on shared primitives
        OrderApplication:
            - OrderDomain
            - SharedDomain
        OrderInfrastructure:
            - OrderDomain
            - SharedDomain
            - DoctrineInfrastructure
            - SharedInfrastructure                    # impl of ports, persistence, etc.
        OrderPresentation:
            - OrderApplication

        # Catalogue BC
        CatalogueDomain: [ SharedDomain ]
        CatalogueApplication:
            - CatalogueDomain
            - SharedDomain

        CatalogueInfrastructure:
            - CatalogueDomain
            - CatalogueApplication
            - SharedDomain
            - DoctrineInfrastructure
            - SharedInfrastructure
            - CatalogueContracts
        CataloguePresentation:
            - CatalogueApplication

        # Cross-BC boundary
        OrderIntegration:
            - OrderApplication                        # implements Order ports
            - CatalogueContracts                      # maps to published language

    analyser:
        types: [ class, use, function_call ]
